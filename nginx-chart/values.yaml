replicaCount: 3

# Service type label for microservice architecture identification
serviceType: "api-gateway"  # Options: api-gateway, frontend, backend-proxy, static-server, etc.

image:
  repository: nginx
  pullPolicy: IfNotPresent
  tag: "latest"

exporter:
  image:
    repository: nginx/nginx-prometheus-exporter
    tag: "0.10.0"
  port: 9113
  resources:
    limits:
      memory: 128Mi
      cpu: 500m
    requests:
      memory: 64Mi
      cpu: 100m

service:
  type: ClusterIP
  port: 80
  metricsPort: 9113

nginx:
  config: |
    log_format custom_format '$remote_addr - $remote_user [$time_local] '
      '"$request" $status $body_bytes_sent '
      '"$http_referer" "$http_user_agent" '
      '$upstream_response_time $hostname {{ .Values.serviceType }}';

    server {
        listen 80;
        server_name localhost;

        access_log /var/log/nginx/access.log custom_format;

        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
        }

        # Simulate 500 errors for /api/error-* endpoints
        location ~ ^/api/error- {
            return 500 "Internal Server Error\n";
        }

        # Simulate 503 errors for /api/unavailable-* endpoints
        location ~ ^/api/unavailable- {
            return 503 "Service Unavailable\n";
        }

        # Simulate 502 errors for /api/badgateway-* endpoints
        location ~ ^/api/badgateway- {
            return 502 "Bad Gateway\n";
        }

        location /nginx_status {
            stub_status on;
            access_log off;
        }

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root /usr/share/nginx/html;
        }
    }

prometheus:
  scrape: true
  port: 9113

trafficGenerator:
  enabled: true
  schedule: "*/2 * * * *"  # Every 2 minutes

dashboard:
  enabled: true

resources: {}

nodeSelector: {}

tolerations: []

affinity: {}
